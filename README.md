# Street_Blockage

## 道路閉塞シミュレータ Blockage_Main.py
### 概要

被害想定を行う地区の構造物の情報を入力し，震災時の道路閉塞状況の予測を行うPythonプログラム．震災時の建物・ブロック塀・電柱の倒壊と道路沈下の発生を乱数により確率的に予測し，それら構造物の被害状況と瓦礫発生量，それに起因する道路閉塞状況を出力する．

### 環境

本シミュレータの実行に必要な環境は以下のとおりである．

- GeoPandas
- Python 3.9
- Numpy
- Pandas
- Scipy
- Shapely 

### 使用方法

#### 入力

建物・道路等の構造物の情報をGeoJSON形式で用意する．sample_dataフォルダ内のファイルに荒川地区におけるデータ整備の例を示している．以下，任意と付記しているものは本シミュレーションに使用していない情報であり，空欄としてよい．

##### 建物

個々の建物に対して以下の属性を与える．

- id：建物の識別番号
- district：建物の位置する街区名（任意）
- totalArea：延床面積（m）
- height：高さ（m，任意）
- storeys：階数
- structure：構造（木造：w，RC造：rc，鉄骨造：s）
- year：建築年代の階級（\~ 1971：0，1972 \~ 1981：1，1982 \~ 1990：2，1991 \~ 2000：3，2001 \~：4）
- usage：建物の用途（任意）
- access：建物に隣接する道路リンクの識別番号（道路リンクについては後述，任意）
- geometry：建物平面の位置情報（shapelyのPolygonオブジェクト）

##### ブロック塀

個々のブロック塀に対して以下の属性を与える．

- id：ブロック塀の識別番号
- height：高さ（mm）
- geometry：ブロック塀の位置情報（shapelyのLineStringオブジェクト）

##### 電柱

個々の電柱に対して以下の属性を与える．

- id：電柱の識別番号
- type：種類（本柱：main，小柱：small，支線柱：sub）
- height：高さ（m）
- geometry：電柱の位置情報（shapelyのPointオブジェクト）

##### 道路平面

道路平面を交差点部分とそれ以外の部分に分割してそれぞれに対して以下の属性を与える．

- id：道路の識別番号
- rank：階級（主要道：1，生活道路：0）
- section：交差点（true，false）
- geometry：道路の位置情報（shapelyのPolygonオブジェクト）

##### 道路リンク

交差点以外の道路平面については 0.75 m 程度の長さに分割し，交差点の道路平面では入出口の組み合わせを取得して「リンク」の形式として道路情報を用意する．「道路平面」を一つ以上の個数に適当に分割したものが「道路リンク」である．

- id：リンクの識別番号（後述）
- section：交差点（true，false）
- length：長さ（m）
- width：幅（m）
- geometry：リンクの位置情報（shapelyのGeometryCollectionオブジェクト，詳細は後述）

本プログラムではリンクの識別番号を次のように付与している；「（道路平面に隣接する道路の番号1）|（道路平面の番号）|（道路平面に隣接する道路の番号2）*（リンク端点のノード番号1）|（リンク端点のノード番号2）」．なお，袋小路等で道路平面の一方にしか隣接する道路がない場合は道路番号2を「-1」と与えている．

リンクの位置情報は5つの図形情報で構成される．１：リンクの平面（shapelyのPolygonオブジェクト），2：リンクの端部の代表点1（shapelyのPointオブジェクト），3：リンクの端部の代表点2（shapelyのPointオブジェクト），4：リンクの端部の境界1（shapelyのLineStringオブジェクト），5：リンクの端部の境界2（shapelyのLineStringオブジェクト）

##### 土質情報

ボーリング調査等による情報を以下のように集計し，ファイルを作成する．

- z1，z2，......，z200：地下 0 m \~ 0.1 m，0.1 m \~ 0.2 m，......，19.9 m \~ 20.0 m と階層ごとに土質情報を与える．それぞれの階層に対して {N：N値，sigma：上載圧（kN/m<sup>2</sup>），sigma_dash：有効上載圧（kN/m<sup>2</sup>），FC：細粒分含有率（%），Cab：50%粒径から求めたN値低減係数}を与える．
- geometry：調査地点（shapelyのPointオブジェクト）

#### 実行

地表面最大加速度（*PGA*），地表面最大速度（*PGV*），計測震度（*I*）のパラメータをファイルの46行目以降で設定する．計測震度は整数値5，6，7の入力が可能である．必要に応じてシミュレーションで適用する各被害モデルの要素を取捨選択してスクリプトを修正し，実行する．

実行時にアウトプットを行うフォルダ名と試行回数の入力が求められるのでこれらを入力する．

#### 出力

シミュレーション結果が試行ごとにcsvファイルで出力される．試行ごとに建物倒壊結果，ブロック塀倒壊結果，電柱倒壊結果，道路沈下結果，道路リンク閉塞結果，瓦礫発生結果の6つのファイルが作成される．ファイルの詳細は以下のとおりである．

##### 建物倒壊結果

- id：建物の識別番号
- status：建物の状態（exist：非倒壊，halfly collapsed：半壊，collapsed：全壊）
- by_who：倒壊原因

##### ブロック塀倒壊結果

- id：ブロック塀の識別番号
- status：ブロック塀の状態（exist：非倒壊，collapsed：倒壊）
- by_who：倒壊原因

##### 電柱倒壊結果

- id：電柱の識別番号
- status：電柱の状態（exist：非倒壊，collapsed：倒壊）
- by_who：倒壊原因

##### 道路沈下結果

- id：道路の識別番号
- status：道路の状態（exist：沈下被害なし，collapsed：沈下被害あり）
- by_who：沈下原因

##### 道路リンク閉塞結果

- id：道路リンクの識別番号
- status：道路リンクの状態（initial：初期状態，blocked：瓦礫流出あり）
- by_who：閉塞原因
- width：災害発生後の道路リンクの幅員
- blockage_rank：閉塞ランク

##### 瓦礫発生結果

- id：瓦礫の識別番号（構造物の種類＋構造物の識別番号）
- mass：材質ごとの瓦礫質量

## 緊急アクセスシミュレータ Emergency_Main.py
### 概要

被害想定を行う地区の構造物の情報を入力し，震災時の道路閉塞状況の予測をもとに緊急車両のアクセス性の検討を行うPythonプログラム．本シミュレータでは，各住戸が火元となった火災時に消防車やホースカーが消防署からその住戸へアクセスする際の到達予測時間を評価対象として想定している．入力情報には前章で挙げたものの他，地区の道路網や起点の道路への接続情報を要し，出力結果として構造物の震災被害状況・瓦礫発生量・道路閉塞状況・各住戸の起点からの到達予測時間を出力する．

### 環境

本シミュレータの実行に必要な環境は以下のとおりである．

- GeoPandas
- Python 3.9
- Numpy
- Pandas
- Scipy
- Shapely 

### 使用方法

#### 入力

建物・道路等の構造物の情報をGeoJSON形式で用意する．sample_dataフォルダ内のファイルに荒川地区におけるデータ整備の例を示している．以下，任意と付記しているものは本シミュレーションに使用していない情報であり，空欄としてよい．

##### 建物

個々の建物に対して以下の属性を与える．

- id：建物の識別番号
- district：建物の位置する街区名（任意）
- totalArea：延床面積（m）
- height：高さ（m，任意）
- storeys：階数
- structure：構造（木造：w，RC造：rc，鉄骨造：s）
- year：建築年代の階級（\~ 1971：0，1972 \~ 1981：1，1982 \~ 1990：2，1991 \~ 2000：3，2001 \~：4）
- usage：建物の用途（任意）
- access：建物に隣接する道路リンクの識別番号（道路リンクについては後述）
- geometry：建物平面の位置情報（shapelyのPolygonオブジェクト）

##### ブロック塀

個々のブロック塀に対して以下の属性を与える．

- id：ブロック塀の識別番号
- height：高さ（mm）
- geometry：ブロック塀の位置情報（shapelyのLineStringオブジェクト）

##### 電柱

個々の電柱に対して以下の属性を与える．

- id：電柱の識別番号
- type：種類（本柱：main，小柱：small，支線柱：sub）
- height：高さ（m）
- geometry：電柱の位置情報（shapelyのPointオブジェクト）

##### 道路平面

道路平面を交差点部分とそれ以外の部分に分割してそれぞれに対して以下の属性を与える．

- id：道路の識別番号
- rank：階級（主要道：1，生活道路：0）
- section：交差点（true，false）
- geometry：道路の位置情報（shapelyのPolygonオブジェクト）

##### 道路リンク

交差点以外の道路平面については 0.75 m 程度の長さに分割し，交差点の道路平面では入出口の組み合わせを取得して「リンク」の形式として道路情報を用意する．「道路平面」を一つ以上の個数に適当に分割したものが「道路リンク」である．

- id：リンクの識別番号（後述）
- section：交差点（true，false）
- length：長さ（m）
- width：幅（m）
- geometry：リンクの位置情報（shapelyのGeometryCollectionオブジェクト，詳細は後述）

本プログラムではリンクの識別番号を次のように付与している；「（道路平面に隣接する道路の番号1）|（道路平面の番号）|（道路平面に隣接する道路の番号2）*（リンク端点のノード番号1）|（リンク端点のノード番号2）」．なお，袋小路等で道路平面の一方にしか隣接する道路がない場合は道路番号2を「-1」と与えている．

リンクの位置情報は5つの図形情報で構成される．１：リンクの平面（shapelyのPolygonオブジェクト），2：リンクの端部の代表点1（shapelyのPointオブジェクト），3：リンクの端部の代表点2（shapelyのPointオブジェクト），4：リンクの端部の境界1（shapelyのLineStringオブジェクト），5：リンクの端部の境界2（shapelyのLineStringオブジェクト）

##### 土質情報

ボーリング調査等による情報を以下のように集計し，ファイルを作成する．

- z1，z2，......，z200：地下 0 m \~ 0.1 m，0.1 m \~ 0.2 m，......，19.9 m \~ 20.0 m と階層ごとに土質情報を与える．それぞれの階層に対して {N：N値，sigma：上載圧（kN/m<sup>2</sup>），sigma_dash：有効上載圧（kN/m<sup>2</sup>），FC：細粒分含有率（%），Cab：50%粒径から求めたN値低減係数}を与える．
- geometry：調査地点（shapelyのPointオブジェクト）
 
##### ノード情報

道路リンクの端点情報について，全道路リンクの端点に対して以下の項目により与える．

- name_from：道路リンクの識別番号の端点番号（後述）
- name_to：ノード番号（後述）
- width：ノード地点における道路幅（任意）
- accessibility：{隣接する建物番号：距離}（任意）
- geometry：ノードの地点（shapelyのPointオブジェクト，任意）

「道路リンクの識別番号の端点番号」は，道路リンクのファイルから「（道路平面に隣接する道路の番号1）|（道路平面の番号）|（道路平面に隣接する道路の番号2）*（0または1）」のように取得できる．「ノード番号」は地区のノードの通し番号であり，同一地点に対して同一の番号を付与する．

##### 起点情報

JSONファイルにより以下項目を与える．複数地点の起点を設定する場合はsample_data内の例のように列挙する．

- name：起点名
- ids：起点が接続するノード番号のリスト
- distance：起点が接続するノード番号への距離（m，起点と接続ノードが離れていない場合は 0 m）

#### 実行

地表面最大加速度（*PGA*），地表面最大速度（*PGV*），計測震度（*I*）のパラメータをファイルの54行目以降で設定する．計測震度は整数値5，6，7の入力が可能である．必要に応じてシミュレーションで適用する各被害モデルの要素を取捨選択してスクリプトを修正し，実行する．

実行時にアウトプットを行うフォルダ名と試行回数の入力が求められるのでこれらを入力する．

#### 出力

シミュレーション結果が試行ごとにcsvファイルで出力される．試行ごとに建物倒壊結果，ブロック塀倒壊結果，電柱倒壊結果，道路沈下結果，道路リンク閉塞結果，瓦礫発生結果の6つのファイルが作成される．ファイルの詳細は以下のとおりである．

##### 建物倒壊結果

- id：建物の識別番号
- status：建物の状態（exist：非倒壊，halfly collapsed：半壊，collapsed：全壊）
- time_access：アクセス所要時間（s，起点から接続ノードへの到達に要する時間に 60 s を加算している．また，起点から住戸までリンクが繋がっていなかった場合は「inf」の値を返す．）
- by_who：倒壊原因

##### ブロック塀倒壊結果

- id：ブロック塀の識別番号
- status：ブロック塀の状態（exist：非倒壊，collapsed：倒壊）
- by_who：倒壊原因

##### 電柱倒壊結果

- id：電柱の識別番号
- status：電柱の状態（exist：非倒壊，collapsed：倒壊）
- by_who：倒壊原因

##### 道路沈下結果

- id：道路の識別番号
- status：道路の状態（exist：沈下被害なし，collapsed：沈下被害あり）
- by_who：沈下原因

##### 道路リンク閉塞結果

- id：道路リンクの識別番号
- status：道路リンクの状態（initial：初期状態，blocked：瓦礫流出あり）
- by_who：閉塞原因
- width：災害発生後の道路リンクの幅員
- blockage_rank：閉塞ランク

##### 瓦礫発生結果

- id：瓦礫の識別番号（構造物の種類＋構造物の識別番号）
- mass：材質ごとの瓦礫質量